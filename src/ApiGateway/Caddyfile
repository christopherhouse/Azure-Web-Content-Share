# Minimal API Gateway Caddyfile
# Simple reverse proxy to internal API with basic routing

{
    # Global options
    admin off
    persist_config off
}

# Main API Gateway server block
:8080 {
    # Health check endpoint - always return 200
    handle /health {
        respond "healthy" 200
    }

    # Route /api/* to backend API
    handle /api/* {
        reverse_proxy {env.API_INTERNAL_URL} {
            header_up Host {upstream_hostport}
            header_up X-Real-IP {remote_host}
            header_up X-Gateway "API-Gateway"
        }
    }
    
    # All other requests return 404
    handle {
        respond "Not Found" 404
    }
}